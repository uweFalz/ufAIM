<!doctype html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>ufAIM – Sandbox</title>

		<link rel="stylesheet" href="./styles.css" />

		<script type="importmap">
			{
				"imports": {
					"three": "https://unpkg.com/three/build/three.module.js"
				}
			}
		</script>

		<script>
			if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
				navigator.serviceWorker?.register("./sw-nocache.js")
				.then(() => console.log("sw-nocache active (DEV) ✅"))
				.catch(err => console.warn("sw-nocache failed", err));
			}
		</script>
	</head>

	<body>
		<header class="topbar">
			<div class="brand">
				<div class="brand__title">ufAIM</div>
				<div class="brand__subtitle" id="status">…</div>
			</div>

			<div class="actions">
				<button id="btnReset" class="btn">Reset</button>

				<button id="btnSave" class="btn">Save</button>
				<button id="btnExport" class="btn">Export</button>

				<button id="btnImport" class="btn btn--primary">Import…</button>
				<input
				id="fileImport"
				type="file"
				multiple
				accept=".json,.ufaim.json,.tra,.gra,application/json,text/plain"
				style="display:none"
				/>

				<button id="btnTrans" class="btn">Transition</button>

				<div class="divider"></div>

				<div class="cursor">
					<button id="btnCursorMinus" class="btn btn--ghost" title="s minus">−</button>
					<label class="cursor__label" for="inputCursorS">s</label>
					<input id="inputCursorS" class="cursor__input" type="number" step="1" value="0" />
					<button id="btnCursorPlus" class="btn btn--ghost" title="s plus">+</button>
				</div>
				
				<div class="picker">
					<label class="picker__label" for="routeProjectSelect">RP</label>
					<select id="routeProjectSelect" class="picker__select">
						<option value="">(none)</option>
					</select>
				</div>
				
				<div class="picker">
					<label class="picker__label" for="slotSelect">Slot</label>
					<select id="slotSelect" class="picker__select">
						<option value="right">right</option>
						<option value="km">km</option>
						<option value="left">left</option>
					</select>
				</div>
				
				<label class="toggle" title="Auto-Fit bei RP/Slot/Geom-Wechsel (DEV)">
					<input id="chkAutoFit" type="checkbox" />
					<span>AutoFit</span>
				</label>		
				<button id="btnFit" class="btn btn--ghost" title="Zoom to active alignment">Fit</button>
				
				<div class="divider"></div>

				<button id="btnPinToggle" class="btn" title="Pin/unpin current (RP+Slot)">Pin</button>
				<button id="btnPinsClear" class="btn btn--ghost" title="Clear all pinned">Unpin all</button>
				<span id="pinsInfo" class="hint" style="margin-left:6px">Pins: 0</span>

				<div class="divider"></div>

				<button id="btnToggleBands" class="btn">Bänder</button>
				<button id="btnToggleSection" class="btn">Schnitt</button>
			</div>
		</header>

		<main class="shell">
			<section class="stage">
				<div class="view view--3d view--full">
					<div class="view__title">3D</div>
					<canvas id="view3d"></canvas>
				</div>

				<!-- Floating Overlays -->
				<div id="overlayBands" class="overlayPane overlayPane--hidden">
					<header class="overlayPane__header">
						<div class="overlayPane__title">Bänder</div>
						<button id="btnCloseBands" class="btn btn--ghost">×</button>
					</header>
					<div id="board2d" class="overlayPane__body">(Bands)</div>
				</div>

				<div id="overlaySection" class="overlayPane overlayPane--hidden">
					<header class="overlayPane__header">
						<div class="overlayPane__title">Schnitt</div>
						<button id="btnCloseSection" class="btn btn--ghost">×</button>
					</header>
					<div id="boardSection" class="overlayPane__body">(Section)</div>
				</div>
			</section>

			<footer class="footer">
				<div class="footer__pane">
					<div class="footer__title">Log</div>
					<pre id="log" class="log log--footer"></pre>
				</div>
				<div class="footer__pane">
					<div class="footer__title">Props</div>
					<pre id="props" class="props props--footer"></pre>
				</div>
			</footer>
		</main>

		<!-- Transition Overlay (optional / legacy) -->
		<section id="transOverlay" class="overlay hidden">
			<div class="overlay__card">
				<header class="overlay__header">
					<div class="overlay__title">Transition Editor</div>
					<button id="btnTransClose" class="btn">Close</button>
				</header>

				<div class="control">
					<label for="familySel">Family</label>
					<select id="familySel"></select>
				</div>

				<div class="control">
					<label for="preset">Preset</label>
					<select id="preset">
						<option value="clothoid">clothoid</option>
						<option value="bloss">bloss</option>
						<option value="berlin">berlin</option>
					</select>
				</div>

				<div class="control">
					<label for="w1">w1</label>
					<input id="w1" type="range" min="0" max="1000" step="1" />
					<div class="hint" id="w1Val">—</div>
				</div>

				<div class="control">
					<label for="w2">w2</label>
					<input id="w2" type="range" min="0" max="1000" step="1" />
					<div class="hint" id="w2Val">—</div>
				</div>
			</div>
		</section>

		<script type="module" src="./main.js"></script>
	</body>
</html>
